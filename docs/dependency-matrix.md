# Dependency Matrix

This matrix records the pinned Long-Term Support (LTS) or release versions we target across local tooling and infrastructure services. Keeping these values aligned avoids configuration drift between developer machines, automation, and runtime containers.

| Dependency                    | Source of Truth                                                                    | Pinned LTS / Release Version               | Upstream Release Date | Runtime / Image Tag                        | Update Cadence                                                              |
| ----------------------------- | ---------------------------------------------------------------------------------- | ------------------------------------------ | --------------------- | ------------------------------------------ | --------------------------------------------------------------------------- |
| Node.js                       | `package.json` (`engines.node`), `.github/workflows/ci.yml` (`actions/setup-node`) | 22.21.0 (LTS)                              | 2025-10-20            | N/A (installed via toolchain)              | Track Node.js LTS drops (roughly twice per year).                           |
| pnpm                          | `package.json` (`engines.pnpm`, `packageManager`)                                  | 10.23.0                                    | 2025-11-20            | N/A (installed via toolchain)              | Update alongside Node.js to keep lockfiles reproducible.                    |
| PostgreSQL                    | `infrastructure/compose/docker-compose.yml` (`postgres` service)                   | 16 (alpine tag tracking latest 16.x patch) | 2023-09-14 (16 GA)    | `postgres:16-alpine`                       | Review quarterly for new 16.x patch releases and CVEs.                      |
| Redis                         | `infrastructure/compose/docker-compose.yml` (`redis` service)                      | 7 (alpine tag tracking latest 7.2 patch)   | 2025-11-02 (7.2.12)   | `redis:7-alpine`                           | Review quarterly to pick up 7.2 security fixes.                             |
| MinIO / S3-compatible storage | `infrastructure/compose/docker-compose.yml` (`minio` service)                      | RELEASE.2024-05-10T01-41-38Z               | 2024-05-10            | `minio/minio:RELEASE.2024-05-10T01-41-38Z` | Review monthly for upstream security advisories.                            |
| EmulatorJS embed server       | `infrastructure/emulator/Dockerfile` (`EMULATORJS_REF` build arg)                  | v4.2.3                                     | 2025-07-05            | `build:../emulator@v4.2.3`                 | Track EmulatorJS release feed monthly; rebuild sooner for security fixes.   |
| Playwright                    | Root `package.json` (`devDependencies.@playwright/test`)                           | 1.56.1                                     | 2025-10-17            | N/A (installed via pnpm workspace)         | Review each quarter to stay close to latest browser engines.                |
| Prisma                        | `backend/package.json` (`dependencies.@prisma/client`, `devDependencies.prisma`)   | 5.15.0                                     | 2024-06-04            | Bundled with backend image                 | Review monthly to track Prisma's security advisories and migration tooling. |
| Next.js                       | `frontend/package.json` (`dependencies.next`)                                      | 14.2.32                                    | 2025-08-18            | Bundled with frontend build                | Review quarterly or after major Next.js canary promotions.                  |
| Fastify                       | `backend/package.json` (`dependencies.fastify`)                                    | 5.6.2                                      | 2025-11-09            | Bundled with backend build                 | Review monthly to stay aligned with Fastify's v5 LTS releases.              |

> ℹ️ For dependencies without an image tag (e.g., Node.js and pnpm), developer environments rely on the pinned versions listed in `package.json` and enforced through CI setup steps. Containerized dependencies inherit their tags directly from `infrastructure/compose/docker-compose.yml` and therefore reflect the same versions in local Docker Compose runs and E2E CI jobs.

## Validation

Our automated workflows keep this document from drifting:

- `.github/workflows/ci.yml` pins Node.js 22.21.0 via `actions/setup-node` and installs pnpm 10.23.0 via `pnpm/action-setup` before running `pnpm install --recursive --frozen-lockfile`, ensuring the toolchain versions above are exercised in every lint, type-check, unit-test, and Playwright matrix job.
- The CI "Playwright" job invokes `scripts/test-e2e.sh`, which boots the Compose stack defined in `infrastructure/compose/docker-compose.yml`. This guarantees the PostgreSQL, Redis, and MinIO versions in the table match the containers that are health-checked before end-to-end tests run.
- Dependency freshness is further enforced through the `dependency_security` job in `ci.yml`, which runs `pnpm audit` and optional `snyk test` to alert us if pinned versions gain vulnerabilities, prompting table updates.
- Supporting workflows inside `.github/workflows/security-ack.yml` and `.github/workflows/security-checklist-ack.yml` gate PRs until the security checklist is acknowledged, which keeps dependency changes reviewed with the same rigor as the matrix updates documented here.
