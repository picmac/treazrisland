# TREAZRISLAND environment template
# Reference docs/TREAZRISLAND_PRD.md and docs/security/threat-model.md before populating.
# This file seeds local development, Docker Compose, and production build pipelines.

# Core runtime (override the secrets below in shared or production environments)
NODE_ENV=development
# Controls the runtime stage used for automatic TLS logic. Supported values:
# production|prod|internet|external|public and development|dev|lan|local|test.
# Leave on `development` for LAN stacks and set to `production` when exposing the stack.
TREAZ_RUNTIME_ENV=development
# Controls TLS-specific middleware. Use `auto` (default) to enforce HTTPS in production while
# relaxing to HTTP for LAN or local development. Override with `https` to hard-require TLS or `http`
# to always disable enforcement.
TREAZ_TLS_MODE=auto
PORT=3001
LISTEN_HOST=0.0.0.0
LOG_LEVEL=debug
POSTGRES_DB=treazrisland
POSTGRES_USER=treazrisland
POSTGRES_PASSWORD=treazrisland
DATABASE_URL="postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@localhost:5432/${POSTGRES_DB}?schema=public"
JWT_SECRET=local-dev-jwt-secret-at-least-32-bytes
JWT_ACCESS_TTL=15m
JWT_REFRESH_TTL=30d
PASSWORD_RESET_TTL=1h
MFA_ISSUER=TREAZRISLAND
MFA_ENCRYPTION_KEY=local-dev-mfa-encryption-key-32-characters
MFA_RECOVERY_CODE_COUNT=10
MFA_RECOVERY_CODE_LENGTH=10
EMAIL_PROVIDER=none
# Uncomment the SMTP block below to enable transactional email
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_SECURE=starttls # options: none, starttls, implicit
# SMTP_USERNAME=mailer
# SMTP_PASSWORD=super-secret-password
# SMTP_FROM_EMAIL=no-reply@treazrisland.test
# SMTP_FROM_NAME=TREAZRISLAND Crew
# SMTP_ALLOW_INVALID_CERTS=false
CORS_ALLOWED_ORIGINS=http://localhost:3000

# Rate limiting (tune per docs/security/hardening-checklist.md)
RATE_LIMIT_DEFAULT_POINTS=60
RATE_LIMIT_DEFAULT_DURATION=60
RATE_LIMIT_AUTH_POINTS=5
RATE_LIMIT_AUTH_DURATION=60

# Netplay orchestration
NETPLAY_IDLE_TIMEOUT=10m
NETPLAY_MAX_HOSTED_SESSIONS=2
NETPLAY_MAX_CONCURRENT_SESSIONS=10
# Comma-separated list of origins allowed to perform WebRTC signaling upgrades
NETPLAY_SIGNAL_ALLOWED_ORIGINS=http://localhost:3000
# ICE server configuration published to clients
NETPLAY_STUN_URIS=stun:turn.treazrisland.localhost:3478
NETPLAY_TURN_URIS=turn:turn.treazrisland.localhost:3478?transport=udp
NETPLAY_TURN_USERNAME=treaz-turn
NETPLAY_TURN_PASSWORD=treaz-turn-secret

# TURN service configuration (coturn container)
TURN_REALM=treazrisland.localhost
TURN_LISTEN_PORT=3478
TURN_TLS_PORT=5349
TURN_MIN_PORT=49152
TURN_MAX_PORT=49999
# Uncomment and set when the TURN host sits behind NAT and needs to advertise a public IP
# TURN_EXTERNAL_IP=203.0.113.10

# Password and invitation policy
USER_INVITE_EXPIRY_HOURS=168
PASSWORD_MIN_LENGTH=8

# Object storage (MinIO/S3 compatible)
MINIO_ROOT_USER=treaz-admin
MINIO_ROOT_PASSWORD=treaz-secret
STORAGE_DRIVER=s3
STORAGE_LOCAL_ROOT=./var/storage
STORAGE_ENDPOINT=http://localhost:9000
STORAGE_REGION=us-east-1
STORAGE_FORCE_PATH_STYLE=true
STORAGE_ACCESS_KEY=treaz-uploader
STORAGE_SECRET_KEY=treaz-uploader-secret
STORAGE_BUCKET_ASSETS=treaz-assets
STORAGE_BUCKET_ROMS=treaz-roms
STORAGE_BUCKET_BIOS=treaz-bios
STORAGE_SIGNED_URL_TTL=900
ROM_UPLOAD_MAX_BYTES=1073741824
USER_AVATAR_MAX_BYTES=5242880

# Player state persistence
PLAY_STATE_MAX_BYTES=1048576
PLAY_STATE_MAX_PER_ROM=5

# Bootstrap secret persistence (used by backend bootstrapSecrets.ts)
TREAZ_CONFIG_ROOT=./var/config
TREAZ_SECRETS_FILE=./var/config/secrets.json

# ScreenScraper integration (admin must rotate their own values; do not commit plaintext secrets)
SCREENSCRAPER_USERNAME=
SCREENSCRAPER_PASSWORD=
# AES-256-GCM key used to decrypt the encrypted developer credentials; store outside of version control
SCREENSCRAPER_SECRET_KEY=
# Generate encrypted blobs with `npm run screenscraper:encrypt`
SCREENSCRAPER_DEV_ID_ENC=
SCREENSCRAPER_DEV_PASSWORD_ENC=
SCREENSCRAPER_BASE_URL=https://www.screenscraper.fr/api2
SCREENSCRAPER_REQUESTS_PER_MINUTE=30
SCREENSCRAPER_CONCURRENCY=2
SCREENSCRAPER_TIMEOUT_MS=15000
SCREENSCRAPER_DEFAULT_LANGUAGE_PRIORITY=en,fr
SCREENSCRAPER_DEFAULT_REGION_PRIORITY=us,eu,wor,jp
SCREENSCRAPER_DEFAULT_MEDIA_TYPES=box-2D,box-3D,wheel,marquee,screenshot,titlescreen
SCREENSCRAPER_ONLY_BETTER_MEDIA=true
SCREENSCRAPER_MAX_ASSETS_PER_TYPE=3

# Frontend
AUTH_API_BASE_URL=http://localhost:3001
NEXT_PUBLIC_API_BASE_URL=http://localhost:3001
NEXT_PUBLIC_PIXEL_THEME=monkey-island
NEXT_PUBLIC_MEDIA_CDN=http://localhost:9000/treaz-assets
NEXT_TELEMETRY_DISABLED=1

# Observability hooks
METRICS_ENABLED=false
# Use a unique token in production; leave blank to disable auth locally.
METRICS_TOKEN=
# Comma-separated list of CIDRs or IPs allowed to scrape metrics when METRICS_ENABLED=true
METRICS_ALLOWED_CIDRS=127.0.0.1/32,172.16.0.0/12
# Optional: forward CSP violation reports from the frontend to a central collector.
OBSERVABILITY_CSP_ENDPOINT=
OBSERVABILITY_CSP_TOKEN=

# Monitoring stack bootstrap (used by infra/docker-compose*.yml)
# Compose resolves this relative to infra/, so the default points at infra/monitoring/secrets/metrics_token.sample.
METRICS_TOKEN_FILE=monitoring/secrets/metrics_token.sample
POSTGRES_EXPORTER_SOURCE=postgresql://treazrisland:treazrisland@postgres:5432/treazrisland?sslmode=disable
MINIO_PROMETHEUS_AUTH_TYPE=public
GRAFANA_ADMIN_USER=treaz-grafana
GRAFANA_ADMIN_PASSWORD=treaz-grafana-secret

# Docker Compose overrides
TREAZ_BACKEND_ENV_FILE=/opt/treazrisland/config/compose.env
TREAZ_FRONTEND_ENV_FILE=/opt/treazrisland/config/compose.env
BACKEND_PORT=3001
FRONTEND_PORT=3000

# LAN development overrides (used by scripts/dev-http.sh)
# DEV_HTTP_BACKEND_BIND_ADDRESS=0.0.0.0
# DEV_HTTP_FRONTEND_BIND_ADDRESS=0.0.0.0
# DEV_HTTP_BACKEND_HOST=192.168.1.50
# DEV_HTTP_FRONTEND_HOST=192.168.1.50

# Nginx / Let's Encrypt reverse proxy
NGINX_SERVER_NAME=treazrisland.localhost
LETSENCRYPT_PRIMARY_DOMAIN=treazrisland.example.com
LETSENCRYPT_ADDITIONAL_DOMAINS=www.treazrisland.example.com
LETSENCRYPT_EMAIL=admin@example.com
NGINX_CONTAINER_NAME=treazrisland-nginx
# Set to true to use Let's Encrypt staging CA while testing automation.
LETSENCRYPT_STAGING=true

# Cloudflare Tunnel (set via `cloudflared tunnel token create`)
CLOUDFLARE_TUNNEL_TOKEN=
